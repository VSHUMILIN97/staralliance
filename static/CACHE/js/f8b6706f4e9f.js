;var ws=new WebSocket("ws://"+window.location.hostname+":8090/");function forceRefresh(){var table=document.getElementById("tableID");var tbody=table.getElementsByTagName('tbody')[0];var trow=tbody.getElementsByTagName('tr');for(var secinter=0;secinter<trow.length;secinter++){var cells=trow[secinter].getElementsByTagName('td');countingstarts=0;for(var trdinter=0;trdinter<cells.length;trdinter++){if(checkBoxState[trdinter]===false){cells[trdinter].classList.toggle('pairhid')}else if(cells[trdinter].innerText==='—'){countingstarts++;}}
if(countingstarts>=checkBoxState.filter(isTrue).length-1){trow[secinter].classList.toggle('hidpairrow')}}}
function searchFunc(){var input,filter,table,tr,td,i,ftable;input=document.getElementById("exchInput");filter=input.value.toUpperCase();ftable=document.getElementById("tableID");table=ftable.getElementsByTagName("tbody")[0];tr=table.getElementsByTagName("tr");for(i=0;i<tr.length;i++){td=tr[i].getElementsByTagName("td")[0];var h=tr[i].getElementsByTagName("th")[0];if(h){if(h.innerHTML.toUpperCase().indexOf(filter)>-1){tr[i].style.display="";}else{tr[i].style.display="none";}}}}
function fix(value){if(value.toString().indexOf('e')){return value.toFixed(8);}
else{return Number(Math.round(value+'e8')+'e-8');}}
function isTrue(value){return value===true}
var checkBoxState=[false,false,false,false,false,false,false,false,false,false,false,false,false];function getCheckedBoxes(chkboxName){var checkboxes=document.getElementsByName(chkboxName);var checkboxesChecked=[];for(var i=0;i<checkboxes.length;i++){if(checkboxes[i].checked){checkboxesChecked.push(true);}
else{checkboxesChecked.push(false);}}
return checkboxesChecked.length>0?checkboxesChecked:null;}
ws.onopen=function(event){};ws.onclose=function(event){if(event.wasClean){alert('Соединение закрыто');}else{alert('Соединение оборвано по причине: '+event.reason+' - код ошибки: '+event.code);}};ws.onerror=function(error){alert('Ошибка - '+error.data);};ws.onmessage=function(event){var msg=JSON.parse(event.data);var json_msg=JSON.parse(msg['ticks']);var table=document.getElementById("tableID");while(table.firstChild)table.removeChild(table.firstChild);var tableHead=document.createElement('thead');table.appendChild(tableHead);var tr=document.createElement('tr');tr.style.minHeight="5px";tableHead.appendChild(tr);var th=document.createElement('th');th.style.width="150px";tr.appendChild(th);inner=0;for(var name in msg['cnames']){var th=document.createElement('th');th.appendChild(document.createTextNode((msg['cnames'])[name]));th.style.width="110px";var checkbox=document.createElement("INPUT");checkbox.type="checkbox";checkbox.name='chck';if(checkBoxState[inner]===true){checkbox.checked=true;}
checkbox.onclick=function(){var chk=getCheckedBoxes('chck');var table=document.getElementById("tableID");var tbody=table.getElementsByTagName('tbody')[0];for(var inty=0;inty<chk.length;inty++){if(chk[inty]===true){checkBoxState[inty]=true;}else{checkBoxState[inty]=false;}}};th.appendChild(checkbox);th.onclick=function(){if(checkbox.disabled===true){alert('Sorry. You cannot choose, until you show all exchanges again.'+' We are working on this problem')}};inner++;tr.appendChild(th);}
var tableBody=document.createElement('tbody');table.appendChild(tableBody);for(var r in msg['rnames']){var tr=document.createElement('tr');var text=(msg['rnames'])[r];var th=document.createElement('th');th.appendChild(document.createTextNode(text));tr.appendChild(th);for(var c in msg['cnames']){var success=false;for(var iter=0;iter<json_msg.length;iter++){var io=json_msg[iter]['Value'];for(var commendme in io){if((io[commendme]['PairName']===(msg['rnames'])[r])&&(io[commendme]['Exchange']===(msg['cnames'])[c])){var td=document.createElement('td');var v=io[commendme]['Tick'];if(v!==0){td.appendChild(document.createTextNode(fix(v)));}else{td.appendChild(document.createTextNode('—'));}
td.setAttribute("id",(msg['rnames'])[r]+"_"+(msg['cnames'])[c]);tr.appendChild(td);success=true;}}}
if(success===false){var td=document.createElement('td');var v='—';td.appendChild(document.createTextNode(v));tr.appendChild(td);}}
tr.setAttribute("title",text);tableBody.appendChild(tr);}
var input=document.getElementById("exchInput");var filter=input.value.toUpperCase();if(filter!==''){searchFunc()}
var tbody=table.getElementsByTagName('tbody')[0];var trow=tbody.getElementsByTagName('tr');for(var i=0,len=trow.length;i<len;i++){var cells=trow[i].getElementsByTagName('td');var max=-999999999,min=99999999999,maxi,mini;for(var j=0,lent=cells.length;j<lent;j++){if(parseFloat(cells[j].innerHTML,10)>max){max=parseFloat(cells[j].innerHTML,10);}
if(parseFloat(cells[j].innerHTML,10)<min){min=parseFloat(cells[j].innerHTML,10);}
if(cells[j].innerText==='—'){cells[j].classList.toggle("nope");}}
if(((max-min)/max)*100>3){for(var j=0,lent=cells.length;j<lent;j++){if(parseFloat(cells[j].innerHTML,10)===max){cells[j].classList.toggle("max");}
else if(parseFloat(cells[j].innerHTML,10)===min){cells[j].classList.toggle("min");}}}
else{trow[i].classList.add("hid");}}
for(var checking=0;checking<checkBoxState.length;checking++){if(checkBoxState[checking]===false){continue}else{forceRefresh();break;}}
var elements=document.getElementsByTagName('tr');for(var i=1;i<elements.length;i++){(elements)[i].addEventListener("click",function(){this.classList.toggle("selected");var ups=this.getElementsByTagName('up');var downs=this.getElementsByTagName('down');var cells=this.getElementsByTagName("td");var h=this.getElementsByTagName("th");for(var i=0,len=cells.length;i<len;i++){cells[i].classList.toggle("selected");}
for(var i=0,len=ups.length;i<len;i++){ups[i].classList.toggle("selected");}
for(var i=0,len=downs.length;i<len;i++){downs[i].classList.toggle("selected");}
for(var i=0,len=h.length;i<len;i++){h[i].classList.toggle("selected");}});}
document.getElementById("scrdiv").addEventListener('scroll',function(){this.querySelector("thead").style.transform="translate(0,"+this.scrollTop+"px)";},false);var btn=document.getElementById("hidebt");if(!btn.hasAttribute("onclick")){document.getElementById("hidebt").addEventListener('click',function(){table.classList.toggle("hideUninteresting");if(this.innerText==="Show less than 3% difference"){this.innerText="Hide less than 3% difference";}
else{this.innerText="Show less than 3% difference";}},false);btn.setAttribute("onclick","true");}
var btn_pair=document.getElementById("pairhider");if(!btn_pair.hasAttribute("onclick")){document.getElementById("pairhider").addEventListener('click',function(){forceRefresh();table.classList.toggle("hidePair");var checkbox=document.getElementsByName("chck");if(this.innerText==="Show Exchanges"){this.innerText="Hide Exchanges";for(var ch_state_block=0;ch_state_block<checkbox.length;ch_state_block++){checkbox[ch_state_block].disabled=false;}}
else{this.innerText="Show Exchanges";for(var ch_state2_block=0;ch_state2_block<checkbox.length;ch_state2_block++){checkbox[ch_state2_block].disabled=true;}}},false);btn_pair.setAttribute("onclick","true");}};